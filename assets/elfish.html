<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="stylesheet" type="text/css" href="elfish.css">

    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/underscore.min.js"></script>
    <script src="scripts/handlebars.min.js"></script>
    <script src="scripts/jquery.loadFromTemplate.min.js"></script>

    <script src="scripts/elfish.js"></script>

    <!-- ÐŠ -->
    <!-- JavaScript / Android bindings -->

    <script type="text/javascript">
    
      /**
       * Copy to CSV to clipboard
       */
      function androidCopy() {
	  Android.toClipboard(exportCSV());
      }

      function androidShare() {
	  var date = new Date();
	  
	  var datestr = date.toUTCString(); 
	  
	  // to use the below, add zero indexing to month and date
	  // (1900+date.getYear()) + "-" + (1+date.getMonth()) + "-" + date.getDate();
	  
	  var subject = "ElFish export data " + datestr;
	  var body = exportCSV();
	  
	  body += "\n\nShared to you via ElFish App, a Marius and Sessility production.";
	  
	  console.log("SHARING");
	  console.log(subject);
	  console.log(body);
	  
	  Android.share(subject, body);
      }

      function androidWrite() {
	  var filename = "elfish-";
	  var date = new Date();
	  filename += (1900+date.getYear());     // YEAR
	  filename += "-";
	  if (date.getMonth()<9) filename+="0";  // MONTH
	  filename += (1+date.getMonth());
	  filename += "-";
	  if (date.getDate()<10) filename+="0";  // DATE
	  filename += date.getDate();
	  filename += "-";
	  if (date.getHours()<9) filename+="0";  // HOURS
	  filename += (1+date.getHours());
	  filename += "-";
	  if (date.getMinutes()<9) filename+="0";// MINUTES 
	  filename += (1+date.getMinutes());
	  filename += "-";
	  if (date.getSeconds()<9) filename+="0";// SECONDS
	  filename += (1+date.getSeconds());
	  
          Android.write(filename,exportCSV());
      }
    
    </script>

    <script type="text/html" id="template-group">
      <div class="group" data-id="group-{{group.id}}">
	<h2 contenteditable="true">{{group.title}} {{group.id}}</h2>
	<!-- TODO insert summary -->
	<div class="group-summary">Summary</div>
      </div>
    </script>
    
    <script type="text/html" id="template-effort">
      <div class="effort" id="effort-{{effort.id}}">
	<h3 contenteditable="true">{{effort.title}} {{effort.id}}</h3>
	<input type="number" min="0" class="catch-input" id="ci-{{effort.groupid}}-{{effort.id}}" />
	<div class="estimate" id="est-{{effort.groupid}}-{{effort.id}}">
	  {{effort.est}}
	</div>
	<div class="ke" id="ke-{{effort.groupid}}-{{effort.id}}">
	  {{effort.ke}}
	</div>
	<div class="te" id="te-{{effort.groupid}}-{{effort.id}}">
	  {{effort.te}}
	</div>
      </div>
    </script>
    
  </head>
  <body>
    <div class="app">
      <h1 contenteditable="true">Species 1</h1>
      <button onClick="createNewSpecies()"><strike>Add species</strike></button>
      <button onClick="createNewGroup()">Add group</button>
      <button onClick="createNewEffort()">Add effort</button>
  </div>
  
    <!-- / JavaScript / Android bindings -->

    <input type="button" value="Copy to clipboard"
	   onClick="androidCopy()" />

    <input type="button" value="Share"
	   onClick="androidShare()" />

    <input type="button" value="Write to file"
	   onClick="androidWrite()" />
    
  </body>
</html>
